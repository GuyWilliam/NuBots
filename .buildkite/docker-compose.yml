version: "3.2"
services:
  generic_image:
    image: nubots/nubots:generic
  generic:
    build:
      context: ./../docker
      # Use these two images as a cache when building this image
      # Assumingly, order is important here as well
      cache_from:
        - generic
        - generic_image
      args:
        platform: generic
        BUILDKIT_INLINE_CACHE: 1
    volumes:
      - type: bind
        source: ./..
        target: /home/nubots/NUbots
        read_only: true
        consistency: cached

  nuc7i7bnh_image:
    image: nubots/nubots:nuc7i7bnh
  nuc7i7bnh:
    build:
      context: ./../docker
      # Use these two images as a cache when building this image
      # Assumingly, order is important here as well
      cache_from:
        - nuc7i7bnh
        - nuc7i7bnh_image
      args:
        platform: nuc7i7bnh
        BUILDKIT_INLINE_CACHE: 1
    volumes:
      - type: bind
        source: ./..
        target: /home/nubots/NUbots
        read_only: true
        consistency: cached

  nuc8i7beh_image:
    image: nubots/nubots:nuc8i7beh
  nuc8i7beh:
    build:
      context: ./../docker
      # Use these two images as a cache when building this image
      # Assumingly, order is important here as well
      cache_from:
        - nuc8i7beh
        - nuc8i7beh_image
      args:
        platform: nuc8i7beh
        BUILDKIT_INLINE_CACHE: 1
    volumes:
      - type: bind
        source: ./..
        target: /home/nubots/NUbots
        read_only: true
        consistency: cached
